# -*- coding: utf-8 -*-
"""Reto Visualización de Datos - Dataset de FIFA 26

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kTfJGYHtvyyLGIODowdtvtpt7VUO_WwC
"""

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

from google.colab import drive
drive.mount('/content/drive')

fifa_datos = pd.read_csv('/content/drive/MyDrive/FC26_20250921.csv', low_memory=False)
fifa_datos.info()

"""El código carga un archivo CSV con datos de jugadores de FIFA y muestra información general del conjunto de datos. En total contiene 12,615 registros y 110 columnas, con diferentes tipos de datos: 61 numéricos decimales, 3 enteros y 46 de texto."""

fifa_datos.head(10)

fifa_datos_premier = fifa_datos[fifa_datos['league_name'] == 'Premier League']

#Average Rating
fifa_datos_mean = fifa_datos_premier['overall'].agg('mean')
print(f"El promedio del rating de los jugadores: {round(fifa_datos_mean, 3)}")

#Players Over Average
players_over_average = fifa_datos_premier[fifa_datos_premier['overall'] >= fifa_datos_mean].shape[0]
print(f"El numero de jugadores que estan por arriba del promedio del rating: {players_over_average}")

#Players Under Average
players_under_average = fifa_datos_premier[fifa_datos_premier['overall'] < fifa_datos_mean].shape[0]
print(f"El numero de jugadores que estan por debajo del promedio del rating: {players_under_average}")

"""El código calcula el **promedio del rating general** de los jugadores (≈ **68.166**) y luego cuenta cuántos jugadores están **por encima** (5,530) y **por debajo** (7,084) de ese promedio. En resumen, muestra que la mayoría de los jugadores tienen un rendimiento **ligeramente superior al promedio** dentro del conjunto de datos.

"""

#Average Wage
mean_wage_eur = fifa_datos_premier['wage_eur'].mean()
print(f"El salario promedio de jugador es: {round(mean_wage_eur, 2)} EUR")

#Players Over Average
players_over_mean_wage = fifa_datos_premier[fifa_datos_premier['wage_eur'] >= mean_wage_eur].shape[0]
print(f"El numero de jugadores que estan por arriba del promedio del salario: {players_over_mean_wage}")

#Players Under Average
players_under_mean_wage = fifa_datos_premier[fifa_datos_premier['wage_eur'] < mean_wage_eur].shape[0]
print(f"El numero de jugadores que estan por debajo del promedio del salario: {players_under_mean_wage}")

"""El código calcula el **salario promedio de los jugadores**, que es aproximadamente **€13,175.92**, y determina cuántos jugadores ganan **por encima** (3,335) y **por debajo** (9,279) de ese promedio.
La interpretación muestra que **la gran mayoría de los jugadores gana menos del salario promedio**, lo que indica una **distribución salarial desigual**, donde pocos jugadores concentran los sueldos más altos.

"""

plt.figure(figsize=(16, 6))
sns.scatterplot(data=fifa_datos_premier, x='overall', y='wage_eur')
plt.axvline(x=fifa_datos_mean, color='r', linestyle='--', label=f'Rating Promedio ({fifa_datos_mean:.2f})')
plt.axhline(y=mean_wage_eur, color='g', linestyle='--', label=f'Salario Promedio ({mean_wage_eur:.2f} EUR)')
plt.title('Relacion entre los Ratings de los jugadores y sus Salarios')
plt.xlabel('Rating de los jugadores')
plt.ylabel('Salario (EUR)')
plt.grid(True)
plt.legend()
plt.show()
#5,530 jugadores están por encima del promedio de rating, y 7,084 por debajo.
#En cuanto al salario, 3,335 jugadores ganan más del promedio, mientras que 9,279 están por debajo del salario medio.
#Correlacion positiva
#Alta desigualdad salarial

"""La gráfica muestra la **relación entre el rating (nivel de habilidad)** y el **salario (EUR)** de los jugadores. La línea roja indica el **rating promedio (68.17)**, mientras que la línea verde representa el **salario promedio (€13,175.92)**.

* **5,530 jugadores** están **por encima del promedio de rating**, y **7,084** por debajo.
* En cuanto al salario, **3,335 jugadores** ganan **más del promedio**, mientras que **9,279** están **por debajo del salario medio**.

La gráfica evidencia una **correlación positiva**: a medida que aumenta el rating, los salarios también tienden a incrementarse. Sin embargo, se observa una **alta desigualdad salarial**, ya que solo una minoría de jugadores con ratings muy altos concentran los sueldos más elevados, mientras que la mayoría, incluso con ratings cercanos al promedio, ganan considerablemente menos.

"""



"""

*   List item

*   List item

*   List item
*   List item


*   List item


*   List item


----------- Olviden esta parte de abajo ---------------



*   List item

*   List item

*   List item
*   List item


*   List item


*   List item

"""

# Sort the DataFrame by 'overall' rating in descending order and reset index
top_10_players = fifa_datos_premier.sort_values(by='overall', ascending=False).head(10).reset_index(drop=True).copy()

# Identify the top 2 players for highlighting
top_2_names = top_10_players.head(2)['short_name'].tolist()

# Assign a single color for highlighting
highlight_color = 'orange'

# Create a bar graph for overall rating with highlighting
plt.figure(figsize=(16, 8))
bars = sns.barplot(data=top_10_players, x='short_name', y='overall', color='skyblue', label='Overall Rating')

# Highlight the top 2 bars with the same color
for i, bar in enumerate(bars.patches):
    if top_10_players.loc[i, 'short_name'] in top_2_names:
        bar.set_color(highlight_color)


plt.title('Overall Rating for Top 10 Players (Top 2 Highlighted)')
plt.xlabel('Player Name')
plt.ylabel('Rating')
plt.xticks(rotation=45, ha='right')
plt.legend(title='Attribute')
plt.grid(axis='y')
plt.ylim(87, top_10_players['overall'].max() + 2) # Set y-axis minimum to 85
plt.tight_layout()
plt.show()

# Highlight the top 2 players (e.g., print their names and key stats)
top_2_players = top_10_players.head(2)
print("Top 2 Players:")
display(top_2_players[['short_name', 'overall', 'potential', 'wage_eur']])

# Select the top 2 players from the previously sorted DataFrame
player1 = top_10_players.iloc[0] # Assuming top_10_players is already sorted by overall rating
player2 = top_10_players.iloc[1]

# Define the 6 most important stats (assuming these are relevant)
important_stats = ['pace', 'shooting', 'passing', 'dribbling', 'defending', 'physic']

# Extract the stats for each player
player1_stats = player1[important_stats]
player2_stats = player2[important_stats]

# Create a DataFrame for plotting
plot_data = pd.DataFrame({
    'Stat': important_stats,
    player1['short_name']: player1_stats.values,
    player2['short_name']: player2_stats.values
})

# Melt the DataFrame to long format for easier plotting with seaborn
plot_data_melted = plot_data.melt(id_vars='Stat', var_name='Player', value_name='Value')

# Create a line plot with markers
plt.figure(figsize=(12, 6))
sns.lineplot(data=plot_data_melted, x='Stat', y='Value', hue='Player', marker='o')

plt.title(f'Comparison of Important Stats for {player1["short_name"]} vs {player2["short_name"]}')
plt.xlabel('Stat')
plt.ylabel('Rating')
plt.grid(True)
plt.legend(title='Player')
plt.tight_layout()
plt.show()



"""# Task
Analiza los datos de jugadores de la Premier League para determinar por qué jugadores con ratings similares tienen salarios diferentes, considerando la posición y la nacionalidad, y visualiza los hallazgos con gráficos y justificaciones.

## Análisis de la relación entre rating y salario

### Subtask:
Visualizar la relación entre el rating general y el salario de los jugadores de la Premier League, destacando posibles agrupaciones o patrones.

**Reasoning**:
Create a scatter plot to visualize the relationship between overall rating and wage for Premier League players, as instructed.
"""

plt.figure(figsize=(12, 8))
sns.scatterplot(data=fifa_datos_premier, x='overall', y='wage_eur', alpha=0.6)
plt.title('Relación entre Rating y Salario de Jugadores de la Premier League')
plt.xlabel('Rating del Jugador')
plt.ylabel('Salario (EUR)')
plt.grid(True)
plt.show()

"""## Exploración por posición

### Subtask:
Analizar cómo varía el salario promedio entre las diferentes posiciones de los jugadores.

**Reasoning**:
Group the DataFrame by player positions and calculate the mean wage for each position.
"""

average_wage_by_position = fifa_datos_premier.groupby('player_positions')['wage_eur'].mean().sort_values(ascending=False)
display(average_wage_by_position)

"""## Exploración por nacionalidad

### Subtask:
Analizar cómo varía el salario promedio entre las diferentes nacionalidades de los jugadores.

**Reasoning**:
Group the data by nationality and calculate the average wage, then sort the results and display them.
"""

average_wage_by_nationality = fifa_datos_premier.groupby('nationality_name')['wage_eur'].mean().sort_values(ascending=False)
display(average_wage_by_nationality)

"""## Análisis combinado (opcional)

### Subtask:
Investigar si hay interacciones entre el rating, la posición y la nacionalidad que puedan explicar las diferencias salariales.

**Reasoning**:
Group the DataFrame by position and nationality, calculate the mean overall rating and wage for each group, sort by wage, and display the top 10.
"""

wage_by_position_nationality = fifa_datos_premier.groupby(['player_positions', 'nationality_name'])[['overall', 'wage_eur']].mean()
wage_by_position_nationality_sorted = wage_by_position_nationality.sort_values(by='wage_eur', ascending=False)
print("Top 10 combinations of position and nationality by average wage:")
display(wage_by_position_nationality_sorted.head(10))

"""**Reasoning**:
Identify and display combinations with similar average ratings but significantly different average wages to highlight potential interactions.


"""

print("\nCombinations with similar overall rating but different average wages:")

# Filter for combinations with overall rating between 85 and 87
similar_overall_ratings = wage_by_position_nationality_sorted[
    (wage_by_position_nationality_sorted['overall'] >= 85) &
    (wage_by_position_nationality_sorted['overall'] <= 87)
].sort_values(by='overall')

display(similar_overall_ratings)

"""## Visualización de ejemplos específicos

### Subtask:
Seleccionar algunos jugadores con ratings similares pero salarios diferentes para analizar sus características (posición, nacionalidad, etc.) y visualizar sus datos.

**Reasoning**:
Filter the DataFrame for players with an 'overall' rating between 85 and 87, then select a few players from this filtered set with different wages, and display their relevant information.
"""

# Filter the fifa_datos_premier DataFrame for players with an overall rating between 85 and 87
filtered_players = fifa_datos_premier[
    (fifa_datos_premier['overall'] >= 85) & (fifa_datos_premier['overall'] <= 87)
].copy()

# Sort by wage to easily pick players with different salaries.
# Let's select a larger sample of players with varying wages within this rating range.
# We can select the top 5 highest paid and the bottom 5 lowest paid in this range.
filtered_players_sorted_wage = filtered_players.sort_values(by='wage_eur', ascending=False)

top_paid_players = filtered_players_sorted_wage.head(5).reset_index(drop=True)
bottom_paid_players = filtered_players_sorted_wage.tail(5).reset_index(drop=True)

# Combine the top and bottom paid players
selected_players = pd.concat([top_paid_players, bottom_paid_players]).reset_index(drop=True)

# Select relevant columns
selected_players_info = selected_players[['short_name', 'overall', 'wage_eur', 'player_positions', 'nationality_name']]

# Display the selected information
print("Selected Players with Similar Overall Rating (85-87) and Different Wages:")
display(selected_players_info)

"""**Reasoning**:
Create a bar plot to visualize the wages of the selected players, add annotations for overall rating and wage, and display the plot.
"""

# Create a bar plot for the wages of the selected players
plt.figure(figsize=(12, 8))
bars = sns.barplot(data=selected_players_info, x='short_name', y='wage_eur', palette='viridis')

# Add title and labels
plt.title('Wage Comparison of Selected Players (Overall Rating 85-87)')
plt.xlabel('Player Name')
plt.ylabel('Wage (EUR)')

# Add annotations for Overall rating and Wage on each bar using the index
for i, bar in enumerate(bars.patches):
    yval = bar.get_height()
    overall_rating = selected_players_info.loc[i, 'overall']
    wage = selected_players_info.loc[i, 'wage_eur']
    plt.text(bar.get_x() + bar.get_width()/2, yval,
             f"Overall: {overall_rating}\nWage: {wage:,.0f} EUR",
             ha='center', va='bottom')

plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

"""**Reasoning**:
Create a bar plot to visualize the wages of the selected players, add annotations for overall rating and wage, and display the plot.


"""

#Grafico de barras de posiciones por sus salaros respectivos

# Group the DataFrame by player positions and calculate the mean wage for each position
average_wage_by_position = fifa_datos_premier.groupby('player_positions')['wage_eur'].mean().sort_values(ascending=False)

plt.figure(figsize=(14, 7))

# Define colors: deep blue for the first two, gray for the rest
colors = ['darkblue'] * 2 + ['gray'] * (len(average_wage_by_position.head(10)) - 2)

average_wage_by_position.head(10).plot(kind='bar', color=colors)
plt.title('Average Wage by Player Position (Top 10)')
plt.xlabel('Player Position(s)')
plt.ylabel('Average Wage (EUR)')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Calculate the average wage and overall rating by nationality
average_stats_by_nationality = fifa_datos_premier.groupby('nationality_name')[['overall', 'wage_eur']].mean().sort_values(by='wage_eur', ascending=False)

# Create the bar plot with average wage and annotations for average overall rating
plt.figure(figsize=(14, 7))
bars = average_stats_by_nationality.head(10)['wage_eur'].plot(kind='bar')

# Define colors: deep blue for the first two, gray for the rest
colors = ['darkblue'] * 1 + ['gray'] * (len(average_stats_by_nationality.head(10)) - 1)
for i, bar in enumerate(bars.patches):
    bar.set_color(colors[i])

# Add title and labels
plt.title('Average Wage and Overall Rating by Nationality (Top 10 by Wage)')
plt.xlabel('Nationality')
plt.ylabel('Average Wage (EUR)')

# Add annotations for Average Overall Rating and Average Wage on each bar
for i, bar in enumerate(bars.patches):
    yval = bar.get_height()
    nationality = average_stats_by_nationality.head(10).index[i]
    avg_overall = average_stats_by_nationality.head(10).loc[nationality, 'overall']
    avg_wage = average_stats_by_nationality.head(10).loc[nationality, 'wage_eur']

    plt.text(bar.get_x() + bar.get_width()/2, yval,
             f"Overall: {avg_overall:.1f}\nWage: {avg_wage:,.0f} EUR",
             ha='center', va='bottom')

plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Filter the data for players with overall rating between 85 and 87
fifa_datos_premier_filtered = fifa_datos_premier[
    (fifa_datos_premier['overall'] >= 85) & (fifa_datos_premier['overall'] <= 87)
].copy()

# Calculate the average wage and overall rating by main position for the filtered data
average_stats_by_main_position_filtered = fifa_datos_premier_filtered.groupby('main_position_full')[['overall', 'wage_eur']].mean().sort_values(by='wage_eur', ascending=False)

# Create the bar plot with average wage and annotations for average overall rating
plt.figure(figsize=(14, 7))
bars = average_stats_by_main_position_filtered.head(10)['wage_eur'].plot(kind='bar')

# Define colors: deep blue for the first two, gray for the rest
colors = ['darkblue'] * 2 + ['gray'] * (len(average_stats_by_main_position_filtered.head(10)) - 2)
for i, bar in enumerate(bars.patches):
    bar.set_color(colors[i])

# Add title and labels
plt.title('Average Wage and Overall Rating by Main Player Position (Overall Rating 85-87, Top 10 by Wage)')
plt.xlabel('Main Player Position')
plt.ylabel('Average Wage (EUR)')

# Add annotations for Average Overall Rating and Average Wage on each bar
for i, bar in enumerate(bars.patches):
    yval = bar.get_height()
    position = average_stats_by_main_position_filtered.head(10).index[i]
    avg_overall = average_stats_by_main_position_filtered.head(10).loc[position, 'overall']
    avg_wage = average_stats_by_main_position_filtered.head(10).loc[position, 'wage_eur']

    plt.text(bar.get_x() + bar.get_width()/2, yval,
             f"Overall: {avg_overall:.1f}\nWage: {avg_wage:,.0f} EUR",
             ha='center', va='bottom')

plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Function to extract a single main position
def get_main_position(position_list):
    if isinstance(position_list, str):
        return position_list.split(',')[0].strip()
    return None

# Use .loc to avoid SettingWithCopyWarning
fifa_datos_premier.loc[:, 'main_position'] = fifa_datos_premier['player_positions'].apply(get_main_position)

# Map abbreviations to full names (based on common FIFA positions)
position_mapping = {
    'ST': 'Striker',
    'CF': 'Centre Forward',
    'LW': 'Left Wing',
    'RW': 'Right Wing',
    'CAM': 'Attacking Midfielder',
    'CM': 'Centre Midfielder',
    'CDM': 'Defensive Midfielder',
    'LM': 'Left Midfielder',
    'RM': 'Right Midfielder',
    'LWB': 'Left Wing Back',
    'RWB': 'Right Wing Back',
    'LB': 'Left Back',
    'RB': 'Right Back',
    'CB': 'Centre Back',
    'GK': 'Goalkeeper'
}

# Use .loc to avoid SettingWithCopyWarning
fifa_datos_premier.loc[:, 'main_position_full'] = fifa_datos_premier['main_position'].map(position_mapping)

# Calculate the average wage by the simplified main position
average_wage_by_main_position = fifa_datos_premier.groupby('main_position_full')['wage_eur'].mean().sort_values(ascending=False)

# Create the bar plot with simplified, full position names
plt.figure(figsize=(14, 7))

# Define colors for the top 10 (first two darkblue, rest gray)
colors = ['darkblue'] * 2 + ['gray'] * (len(average_wage_by_main_position.head(10)) - 2)

average_wage_by_main_position.head(10).plot(kind='bar', color=colors)
plt.title('Average Wage by Main Player Position (Top 10)')
plt.xlabel('Main Player Position')
plt.ylabel('Average Wage (EUR)')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

"""## Resumen y conclusiones

### Subtask:
Presentar un resumen de los hallazgos clave y las posibles razones de las diferencias salariales observadas.

## Summary:

### Data Analysis Key Findings

* A scatter plot of overall rating vs. salary showed a general upward trend, indicating that higher-rated players tend to earn more, but there is significant spread, suggesting other factors influence salary.
* Average wages vary significantly by player position. Combinations of attacking midfield and forward positions generally have the highest average salaries.
* Average wages also vary by nationality. The top nationalities with the highest average wages in the dataset include Egypt, Ecuador, and New Zealand.
* Analyzing combinations of position and nationality revealed that even with similar overall ratings (between 85 and 87), average wages can differ significantly based on the specific position and nationality. For example, players with an overall rating of 87 in "CM, CAM" from Norway had a higher average wage than players with the same overall rating in "CDM, CM" from Ecuador.
* Specific player examples with similar ratings (85-87) showed considerable differences in their actual wages, further highlighting the influence of factors beyond just the overall rating.

### Insights or Next Steps

* While overall rating is a factor, player position and nationality are significant contributors to salary differences among Premier League players with similar performance levels.
* Further analysis could involve building a regression model to quantify the impact of position, nationality, and their interactions on player wages, controlling for overall rating and other potential variables like age or market value.
"""